<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="TovalTech - Tecnología para empresas y particulares. Hardware, periféricos y soluciones informáticas.">
  <title>TovalTech | Tecnología Empresarial</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
  
  <!-- Styles -->
  <link rel="stylesheet" href="/src/styles/global.css">
  <link rel="stylesheet" href="/src/styles/home.css">
  <link rel="stylesheet" href="/src/styles/store.css">
  
  <!-- Preconnect para Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="siteHeader">
      <div class="headerInner">
        <a href="/" data-link class="siteLogo">
          <div class="logoIcon">T</div>
          <span>TovalTech</span>
        </a>
        
        <nav class="mainNav">
          <ul class="navLinks">
            <li><a href="/" data-link data-nav-link>Home</a></li>
            <li><a href="/tienda" data-link data-nav-link>Tienda</a></li>
            <li data-admin-only style="display: none;">
              <a href="/catalogo" data-link data-nav-link>Catálogo</a>
            </li>
            <li data-admin-only style="display: none;">
              <a href="/proveedores" data-link data-nav-link>Proveedores</a>
            </li>
            <li><a href="/contacto" data-link data-nav-link>Contacto</a></li>
          </ul>
        </nav>
        
        <div class="headerActions">
          <button class="themeToggle" id="themeToggle" aria-label="Cambiar tema">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="5"/>
              <line x1="12" y1="1" x2="12" y2="3"/>
              <line x1="12" y1="21" x2="12" y2="23"/>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
              <line x1="1" y1="12" x2="3" y2="12"/>
              <line x1="21" y1="12" x2="23" y2="12"/>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
          </button>
          
          <div class="cartIcon" data-client-only style="display: none;">
            <a href="/carrito" data-link class="btn btnSecondary">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="9" cy="21" r="1"/>
                <circle cx="20" cy="21" r="1"/>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
              </svg>
              <span class="cartBadge" style="display: none;">0</span>
            </a>
          </div>
          
          <div class="userMenu" id="userMenu">
            <!-- Se llenará dinámicamente según estado de auth -->
          </div>
          
          <button class="btn btnSecondary mobileMenuBtn" id="mobileMenuBtn" aria-label="Menú">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="3" y1="12" x2="21" y2="12"/>
              <line x1="3" y1="6" x2="21" y2="6"/>
              <line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
          </button>
        </div>
      </div>
    </header>
    
    <!-- Main Content -->
    <main id="appContent">
      <!-- Las páginas se inyectan aquí vía router -->
      <div class="loading">Cargando...</div>
    </main>
    
    <!-- Footer -->
    <footer class="siteFooter">
      <div class="footerInner">
        <div class="footerCol">
          <h3>TovalTech</h3>
          <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
            Tecnología para empresas y particulares. Hardware, periféricos y soluciones informáticas.
          </p>
        </div>
        
        <div class="footerCol">
          <h3>Productos</h3>
          <ul>
            <li><a href="/tienda?cat=monitores" data-link>Monitores</a></li>
            <li><a href="/tienda?cat=componentes" data-link>Componentes PC</a></li>
            <li><a href="/tienda?cat=perifericos" data-link>Periféricos</a></li>
            <li><a href="/tienda?cat=redes" data-link>Networking</a></li>
          </ul>
        </div>
        
        <div class="footerCol">
          <h3>Servicios</h3>
          <ul>
            <li><a href="/cotizaciones" data-link>Cotizaciones</a></li>
            <li><a href="/abastecimiento" data-link>Abastecimiento</a></li>
            <li><a href="/soporte" data-link>Soporte & Asesoría</a></li>
          </ul>
        </div>
        
        <div class="footerCol">
          <h3>Contacto</h3>
          <ul>
            <li><a href="mailto:info@tovaltech.com">info@tovaltech.com</a></li>
            <li><a href="tel:+5491134567890">+54 9 11 3456-7890</a></li>
            <li><a href="/contacto" data-link>Formulario de contacto</a></li>
          </ul>
        </div>
      </div>
      
      <div class="footerBottom">
        <p>&copy; 2026 TovalTech. Todos los derechos reservados.</p>
      </div>
    </footer>
  </div>
  
  <!-- Scripts -->
  <script type="module" src="/src/main.js"></script>
  
  <script>
    // Theme Toggle
    const themeToggle = document.getElementById('themeToggle');
    const html = document.documentElement;
    
    // Cargar tema guardado
    const savedTheme = localStorage.getItem('toval_theme') || 'dark';
    html.setAttribute('data-theme', savedTheme);
    
    themeToggle?.addEventListener('click', () => {
      const current = html.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      
      html.setAttribute('data-theme', next);
      localStorage.setItem('toval_theme', next);
    });
    
    // Update cart badge on load
    function updateCartBadge() {
      try {
        const stored = localStorage.getItem('toval_cart');
        const cart = stored ? JSON.parse(stored) : [];
        const total = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
        
        const badge = document.querySelector('.cartBadge');
        if (badge) {
          badge.textContent = total;
          badge.style.display = total > 0 ? 'flex' : 'none';
        }
      } catch {
        // ignore
      }
    }
    
    updateCartBadge();
    
    // Update user menu
    async function updateUserMenu() {
      const userMenu = document.getElementById('userMenu');
      if (!userMenu) return;
      
      const token = localStorage.getItem('toval_token');
      
      if (!token) {
        userMenu.innerHTML = `
          <a href="/login" data-link class="btn btnPrimary">
            Ingresar
          </a>
        `;
        return;
      }
      
      try {
        const res = await fetch('/api/me', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        
        if (!res.ok) throw new Error();
        
        const data = await res.json();
        const user = data.user;
        
        userMenu.innerHTML = `
          <div style="display: flex; align-items: center; gap: 12px;">
            <span style="font-size: 14px; color: var(--text-secondary);">
              ${user.name || user.email}
            </span>
            <button class="btn btnSecondary" onclick="logout()">
              Salir
            </button>
          </div>
        `;
      } catch {
        localStorage.removeItem('toval_token');
        updateUserMenu();
      }
    }
    
    function logout() {
      localStorage.removeItem('toval_token');
      window.location.href = '/';
    }
    
    updateUserMenu();
  </script>
</body>
</html>
